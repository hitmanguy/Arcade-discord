{"version":3,"sources":["../src/video_source.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2024 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport { create } from '@bufbuild/protobuf';\nimport { FfiClient, FfiHandle } from './ffi_client.js';\nimport type {\n  CaptureVideoFrameResponse,\n  NewVideoSourceResponse,\n  VideoSourceInfo,\n} from './proto/video_frame_pb.js';\nimport {\n  CaptureVideoFrameRequestSchema,\n  NewVideoSourceRequestSchema,\n  VideoRotation,\n  VideoSourceType,\n} from './proto/video_frame_pb.js';\nimport type { VideoFrame } from './video_frame.js';\n\nexport class VideoSource {\n  /** @internal */\n  info: VideoSourceInfo;\n  /** @internal */\n  ffiHandle: FfiHandle;\n\n  width: number;\n  height: number;\n\n  constructor(width: number, height: number) {\n    this.width = width;\n    this.height = height;\n\n    const req = create(NewVideoSourceRequestSchema, {\n      type: VideoSourceType.VIDEO_SOURCE_NATIVE,\n      resolution: {\n        width: width,\n        height: height,\n      },\n    });\n\n    const res = FfiClient.instance.request<NewVideoSourceResponse>({\n      message: {\n        case: 'newVideoSource',\n        value: req,\n      },\n    });\n\n    this.info = res.source!.info!;\n    this.ffiHandle = new FfiHandle(res.source!.handle!.id);\n  }\n\n  captureFrame(\n    frame: VideoFrame,\n    timestampUs = BigInt(0),\n    rotation = VideoRotation.VIDEO_ROTATION_0,\n  ) {\n    const req = create(CaptureVideoFrameRequestSchema, {\n      sourceHandle: this.ffiHandle.handle,\n      buffer: frame.protoInfo(),\n      rotation,\n      timestampUs,\n    });\n\n    FfiClient.instance.request<CaptureVideoFrameResponse>({\n      message: { case: 'captureVideoFrame', value: req },\n    });\n  }\n}\n"],"mappings":"AAGA,SAAS,cAAc;AACvB,SAAS,WAAW,iBAAiB;AAMrC;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AAGA,MAAM,YAAY;AAAA,EASvB,YAAY,OAAe,QAAgB;AACzC,SAAK,QAAQ;AACb,SAAK,SAAS;AAEd,UAAM,MAAM,OAAO,6BAA6B;AAAA,MAC9C,MAAM,gBAAgB;AAAA,MACtB,YAAY;AAAA,QACV;AAAA,QACA;AAAA,MACF;AAAA,IACF,CAAC;AAED,UAAM,MAAM,UAAU,SAAS,QAAgC;AAAA,MAC7D,SAAS;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,MACT;AAAA,IACF,CAAC;AAED,SAAK,OAAO,IAAI,OAAQ;AACxB,SAAK,YAAY,IAAI,UAAU,IAAI,OAAQ,OAAQ,EAAE;AAAA,EACvD;AAAA,EAEA,aACE,OACA,cAAc,OAAO,CAAC,GACtB,WAAW,cAAc,kBACzB;AACA,UAAM,MAAM,OAAO,gCAAgC;AAAA,MACjD,cAAc,KAAK,UAAU;AAAA,MAC7B,QAAQ,MAAM,UAAU;AAAA,MACxB;AAAA,MACA;AAAA,IACF,CAAC;AAED,cAAU,SAAS,QAAmC;AAAA,MACpD,SAAS,EAAE,MAAM,qBAAqB,OAAO,IAAI;AAAA,IACnD,CAAC;AAAA,EACH;AACF;","names":[]}